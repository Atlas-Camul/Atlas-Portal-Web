import React, { useState, useEffect, useRef } from 'react'
import { NavLink, useLocation } from 'react-router-dom'
import SidebarLinkGroup from './SidebarLinkGroup'
import Logo from '../images/logo/logo.svg'
import navBackground from '../images/logo/navBackground.svg'

const Sidebar = ({ sidebarOpen, setSidebarOpen }) => {
  const location = useLocation()
  const { pathname } = location

  const trigger = useRef(null)
  const sidebar = useRef(null)

  const storedSidebarExpanded = localStorage.getItem('sidebar-expanded')
  const [sidebarExpanded, setSidebarExpanded] = useState(
    storedSidebarExpanded === null ? false : storedSidebarExpanded === 'true'
  )

  // close on click outside
  useEffect(() => {
    const clickHandler = ({ target }) => {
      if (!sidebar.current || !trigger.current) return
      if (
        !sidebarOpen ||
        sidebar.current.contains(target) ||
        trigger.current.contains(target)
      )
        return
      setSidebarOpen(false)
    }
    document.addEventListener('click', clickHandler)
    return () => document.removeEventListener('click', clickHandler)
  })

  // close if the esc key is pressed
  useEffect(() => {
    const keyHandler = ({ keyCode }) => {
      if (!sidebarOpen || keyCode !== 27) return
      setSidebarOpen(false)
    }
    document.addEventListener('keydown', keyHandler)
    return () => document.removeEventListener('keydown', keyHandler)
  })

  useEffect(() => {
    localStorage.setItem('sidebar-expanded', sidebarExpanded)
    if (sidebarExpanded) {
      document.querySelector('body').classList.add('sidebar-expanded')
    } else {
      document.querySelector('body').classList.remove('sidebar-expanded')
    }
  }, [sidebarExpanded])

  return (
    <aside
      ref={sidebar}
      className={`absolute left-0 top-0 z-9999 flex h-screen w-72.5 flex-col overflow-y-hidden bg-primary duration-300 ease-linear dark: lg:static lg:translate-x-0 ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'
        }`}
    >
      {/* <!-- SIDEBAR HEADER --> */}
      <div className='flex items-center justify-between gap-2 px-6 py-5.5 lg:py-6.5'>
        <NavLink to='/' className='px-13 z-1'>
          <img src={Logo} alt='Logo' />
        </NavLink>
        <img src={navBackground} alt='nav-background' className='absolute bottom-0 left-0 w-96 z-0' />

        <button
          ref={trigger}
          onClick={() => setSidebarOpen(!sidebarOpen)}
          aria-controls='sidebar'
          aria-expanded={sidebarOpen}
          className='block lg:hidden z-1'
        >
          <svg
            className='fill-current text-white'
            width='20'
            height='18'
            viewBox='0 0 20 18'
            fill='none'
            xmlns='http://www.w3.org/2000/svg'
          >
            <path
              d='M19 8.175H2.98748L9.36248 1.6875C9.69998 1.35 9.69998 0.825 9.36248 0.4875C9.02498 0.15 8.49998 0.15 8.16248 0.4875L0.399976 8.3625C0.0624756 8.7 0.0624756 9.225 0.399976 9.5625L8.16248 17.4375C8.31248 17.5875 8.53748 17.7 8.76248 17.7C8.98748 17.7 9.17498 17.625 9.36248 17.475C9.69998 17.1375 9.69998 16.6125 9.36248 16.275L3.02498 9.8625H19C19.45 9.8625 19.825 9.4875 19.825 9.0375C19.825 8.55 19.45 8.175 19 8.175Z'
              fill=''
            />
          </svg>
        </button>
      </div>
      {/* <!-- SIDEBAR HEADER --> */}

      <div className='no-scrollbar flex flex-col overflow-y-auto duration-300 ease-linear'>
        {/* <!-- Sidebar Menu --> */}
        <nav className='mt-5 py-4 px-4 lg:mt-9 lg:px-6'>
          {/* <!-- Menu Group --> */}
          <div>
            {/* <h3 className='mb-4 ml-4 text-sm font-semibold text-bodydark2'>
              MENU
            </h3> */}

            <ul className='mb-6 flex flex-col gap-1.5 z-10'>
              {/* <!-- Menu Item Home --> */}
              <li>
                <NavLink
                  to='/'
                  className={`group relative flex items-center gap-2.5 rounded-sm py-2 px-4 font-medium text-bodydark1 duration-300 ease-in-out hover:bg-secondary dark:hover: ${pathname.includes('calendar') &&
                    'bg-secondary dark:'
                    }`}
                >
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M10.233 3.09651C10.0808 3.05219 9.91916 3.05219 9.76691 3.09651C9.72316 3.10927 9.64616 3.14119 9.48241 3.26516C9.31025 3.39554 9.09941 3.58214 8.77091 3.87415L4.40453 7.75535C3.86924 8.23118 3.71749 8.37469 3.61199 8.53335C3.51051 8.68602 3.4349 8.85435 3.38823 9.0316C3.3397 9.21594 3.33329 9.4246 3.33329 10.1409V13.3334C3.33329 14.1214 3.33375 14.6706 3.36307 15.1004C3.3919 15.5229 3.4458 15.7689 3.5236 15.9567C3.77733 16.5693 4.26401 17.056 4.87658 17.3097C5.06441 17.3875 5.3104 17.4414 5.73283 17.4703C6.16275 17.4996 6.71199 17.5 7.49996 17.5H12.5C13.2879 17.5 13.8372 17.4996 14.2671 17.4703C14.6895 17.4414 14.9355 17.3875 15.1233 17.3097C15.7359 17.056 16.2226 16.5693 16.4763 15.9567C16.5541 15.7689 16.608 15.5229 16.6368 15.1004C16.6662 14.6706 16.6667 14.1214 16.6667 13.3334V10.1409C16.6667 9.4246 16.6602 9.21594 16.6117 9.0316C16.565 8.85435 16.4894 8.68602 16.3879 8.53335C16.2824 8.37469 16.1307 8.23118 15.5954 7.75535L11.229 3.87415C10.9005 3.58214 10.6897 3.39554 10.5175 3.26516C10.3537 3.14119 10.2767 3.10927 10.233 3.09651ZM9.30091 1.49632C9.7575 1.36337 10.2424 1.36337 10.699 1.49632C11.0157 1.58858 11.2784 1.75081 11.5235 1.93638C11.7543 2.11114 12.0143 2.34222 12.3137 2.60831L16.7027 6.50968C16.7263 6.53068 16.7496 6.55139 16.7727 6.57184C17.2074 6.95786 17.5357 7.24948 17.7759 7.61066C17.9788 7.91599 18.1301 8.25269 18.2234 8.60727C18.3338 9.02669 18.3337 9.46585 18.3333 10.0472C18.3333 10.078 18.3333 10.1092 18.3333 10.1409V13.3629C18.3333 14.1144 18.3333 14.7206 18.2997 15.2139C18.265 15.7212 18.1921 16.1698 18.0162 16.5945C17.5932 17.6155 16.7821 18.4266 15.7612 18.8495C15.3364 19.0254 14.8878 19.0984 14.3805 19.133C13.8872 19.1667 13.281 19.1667 12.5296 19.1667H7.47036C6.71889 19.1667 6.11272 19.1667 5.61938 19.133C5.1121 19.0984 4.66353 19.0254 4.23878 18.8495C3.21783 18.4266 2.40669 17.6154 1.9838 16.5945C1.80786 16.1698 1.73489 15.7212 1.70027 15.2139C1.66661 14.7206 1.66662 14.1144 1.66662 13.3629V10.1409C1.66662 10.1092 1.66661 10.078 1.6666 10.0472C1.66629 9.46585 1.66606 9.02669 1.7765 8.60727C1.86986 8.25269 2.02106 7.91599 2.22403 7.61066C2.46413 7.24948 2.79254 6.95786 3.22726 6.57185C3.2503 6.55139 3.27362 6.53068 3.29726 6.50968L7.68628 2.60832C7.98561 2.34222 8.24555 2.11114 8.47641 1.93638C8.7215 1.75081 8.98416 1.58858 9.30091 1.49632Z" fill="white" />
                  </svg>
                  Home
                </NavLink>
              </li>
              {/* <!-- Menu Item Home --> */}

              {/* <!-- Menu Item Profile --> */}
              <li>
                <NavLink
                  to='/beacon-management'
                  className={`group relative flex items-center gap-2.5 rounded-sm py-2 px-4 font-medium text-bodydark1 duration-300 ease-in-out hover:bg-secondary dark:hover: ${pathname.includes('profile') && 'bg-secondary dark:'
                    }`}
                >
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g filter="url(#filter0_d_906_15199)">
                      <path d="M10.4167 9.16668C10.1695 9.16668 9.92778 9.23999 9.72222 9.37734C9.51665 9.51469 9.35644 9.70991 9.26183 9.93832C9.16722 10.1667 9.14247 10.4181 9.1907 10.6605C9.23893 10.903 9.35798 11.1257 9.53279 11.3006C9.70761 11.4754 9.93034 11.5944 10.1728 11.6427C10.4153 11.6909 10.6666 11.6661 10.895 11.5715C11.1234 11.4769 11.3187 11.3167 11.456 11.1111C11.5934 10.9056 11.6667 10.6639 11.6667 10.4167C11.6662 10.0853 11.5344 9.7676 11.3001 9.53328C11.0658 9.29895 10.7481 9.16712 10.4167 9.16668ZM6.59668 14.3492C5.57276 13.2962 4.99991 11.8854 4.99991 10.4167C4.99991 8.94795 5.57276 7.53714 6.59668 6.48418L7.19501 7.06501C6.32228 7.96243 5.83402 9.16487 5.83402 10.4167C5.83402 11.6685 6.32228 12.8709 7.19501 13.7683L6.59668 14.3492ZM4.22585 16.595C2.5897 14.9551 1.67084 12.7332 1.67084 10.4167C1.67084 8.10016 2.5897 5.87824 4.22585 4.23834L4.81501 4.82751C3.33509 6.31113 2.50399 8.32113 2.50399 10.4167C2.50399 12.5122 3.33509 14.5222 4.81501 16.0058L4.22585 16.595ZM14.2367 14.3492L13.6383 13.7683C14.5111 12.8709 14.9993 11.6685 14.9993 10.4167C14.9993 9.16487 14.5111 7.96243 13.6383 7.06501L14.2367 6.48418C15.2606 7.53714 15.8334 8.94795 15.8334 10.4167C15.8334 11.8854 15.2606 13.2962 14.2367 14.3492ZM16.6075 16.595L16.0183 16.0058C17.4983 14.5222 18.3294 12.5122 18.3294 10.4167C18.3294 8.32113 17.4983 6.31113 16.0183 4.82751L16.6075 4.23834C18.2437 5.87824 19.1625 8.10016 19.1625 10.4167C19.1625 12.7332 18.2437 14.9551 16.6075 16.595Z" fill="white" />
                      <path d="M10.4167 9.16668C10.1695 9.16668 9.92778 9.23999 9.72222 9.37734C9.51665 9.51469 9.35644 9.70991 9.26183 9.93832C9.16722 10.1667 9.14247 10.4181 9.1907 10.6605C9.23893 10.903 9.35798 11.1257 9.53279 11.3006C9.70761 11.4754 9.93034 11.5944 10.1728 11.6427C10.4153 11.6909 10.6666 11.6661 10.895 11.5715C11.1234 11.4769 11.3187 11.3167 11.456 11.1111C11.5934 10.9056 11.6667 10.6639 11.6667 10.4167C11.6662 10.0853 11.5344 9.7676 11.3001 9.53328C11.0658 9.29895 10.7481 9.16712 10.4167 9.16668ZM6.59668 14.3492C5.57276 13.2962 4.99991 11.8854 4.99991 10.4167C4.99991 8.94795 5.57276 7.53714 6.59668 6.48418L7.19501 7.06501C6.32228 7.96243 5.83402 9.16487 5.83402 10.4167C5.83402 11.6685 6.32228 12.8709 7.19501 13.7683L6.59668 14.3492ZM4.22585 16.595C2.5897 14.9551 1.67084 12.7332 1.67084 10.4167C1.67084 8.10016 2.5897 5.87824 4.22585 4.23834L4.81501 4.82751C3.33509 6.31113 2.50399 8.32113 2.50399 10.4167C2.50399 12.5122 3.33509 14.5222 4.81501 16.0058L4.22585 16.595ZM14.2367 14.3492L13.6383 13.7683C14.5111 12.8709 14.9993 11.6685 14.9993 10.4167C14.9993 9.16487 14.5111 7.96243 13.6383 7.06501L14.2367 6.48418C15.2606 7.53714 15.8334 8.94795 15.8334 10.4167C15.8334 11.8854 15.2606 13.2962 14.2367 14.3492ZM16.6075 16.595L16.0183 16.0058C17.4983 14.5222 18.3294 12.5122 18.3294 10.4167C18.3294 8.32113 17.4983 6.31113 16.0183 4.82751L16.6075 4.23834C18.2437 5.87824 19.1625 8.10016 19.1625 10.4167C19.1625 12.7332 18.2437 14.9551 16.6075 16.595Z" stroke="white" stroke-width="0.008" />
                    </g>
                    <path d="M0 0H20V20H0V0Z" stroke="white" stroke-width="0.008" />
                    <defs>
                      <filter id="filter0_d_906_15199" x="-2.33319" y="2.56256" width="25.4997" height="23.7088" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                        <feFlood flood-opacity="0" result="BackgroundImageFix" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
                        <feOffset dy="4" />
                        <feGaussianBlur stdDeviation="2" />
                        <feComposite in2="hardAlpha" operator="out" />
                        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
                        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_906_15199" />
                        <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_906_15199" result="shape" />
                      </filter>
                    </defs>
                  </svg>
                  Beacon Management
                </NavLink>
              </li>
              {/* <!-- Menu Item Profile --> */}

              {/* <!-- Menu Item Tables --> */}
              <li>
                <NavLink
                  to='/user-management'
                  className={`group relative flex items-center gap-2.5 rounded-sm py-2 px-4 font-medium text-bodydark1 duration-300 ease-in-out hover:bg-secondary dark:hover: ${pathname.includes('tables') && 'bg-secondary dark:'
                    }`}
                >
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12.3214 12.8571C13.209 12.8571 13.9286 13.5767 13.9286 14.4643V15.5371L13.923 15.6146C13.701 17.1333 12.3368 17.8636 10.0477 17.8636C7.76688 17.8636 6.38095 17.1416 6.08178 15.6404L6.07145 15.5357V14.4643C6.07145 13.5767 6.79099 12.8571 7.67859 12.8571H12.3214ZM12.3214 13.9285H7.67859C7.38272 13.9285 7.14287 14.1684 7.14287 14.4643V15.4788C7.34272 16.3363 8.25046 16.7921 10.0477 16.7921C11.8449 16.7921 12.7119 16.3412 12.8572 15.4951V14.4643C12.8572 14.1684 12.6173 13.9285 12.3214 13.9285ZM13.0311 8.57062L16.9643 8.5714C17.8519 8.5714 18.5714 9.29095 18.5714 10.1785V11.2514L18.5658 11.3289C18.3438 12.8476 16.9797 13.5779 14.6906 13.5779L14.4657 13.5755C14.2549 13.0658 13.868 12.6484 13.381 12.3982C13.7487 12.4703 14.1844 12.5064 14.6906 12.5064C16.4878 12.5064 17.3548 12.0555 17.5 11.2094V10.1785C17.5 9.88268 17.2602 9.64283 16.9643 9.64283H13.2143C13.2143 9.26686 13.1498 8.90596 13.0311 8.57062ZM3.03573 8.5714L6.96891 8.57062C6.87005 8.85007 6.80875 9.14727 6.79106 9.45615L6.78573 9.64283H3.03573C2.73986 9.64283 2.50002 9.88268 2.50002 10.1785V11.1931C2.69987 12.0505 3.60761 12.5064 5.40487 12.5064C5.8492 12.5064 6.23668 12.4789 6.57045 12.4246C6.10562 12.677 5.73713 13.0838 5.53312 13.5761L5.40487 13.5779C3.12403 13.5779 1.73809 12.8559 1.43892 11.3547L1.42859 11.25V10.1785C1.42859 9.29095 2.14813 8.5714 3.03573 8.5714ZM10 7.14283C11.3807 7.14283 12.5 8.26212 12.5 9.64283C12.5 11.0235 11.3807 12.1428 10 12.1428C8.61931 12.1428 7.50002 11.0235 7.50002 9.64283C7.50002 8.26212 8.61931 7.14283 10 7.14283ZM10 8.21426C9.21104 8.21426 8.57145 8.85385 8.57145 9.64283C8.57145 10.4318 9.21104 11.0714 10 11.0714C10.789 11.0714 11.4286 10.4318 11.4286 9.64283C11.4286 8.85385 10.789 8.21426 10 8.21426ZM14.6429 2.85712C16.0236 2.85712 17.1429 3.9764 17.1429 5.35712C17.1429 6.73783 16.0236 7.85712 14.6429 7.85712C13.2622 7.85712 12.1429 6.73783 12.1429 5.35712C12.1429 3.9764 13.2622 2.85712 14.6429 2.85712ZM5.35716 2.85712C6.73787 2.85712 7.85716 3.9764 7.85716 5.35712C7.85716 6.73783 6.73787 7.85712 5.35716 7.85712C3.97645 7.85712 2.85716 6.73783 2.85716 5.35712C2.85716 3.9764 3.97645 2.85712 5.35716 2.85712ZM14.6429 3.92855C13.8539 3.92855 13.2143 4.56814 13.2143 5.35712C13.2143 6.1461 13.8539 6.78569 14.6429 6.78569C15.4319 6.78569 16.0714 6.1461 16.0714 5.35712C16.0714 4.56814 15.4319 3.92855 14.6429 3.92855ZM5.35716 3.92855C4.56818 3.92855 3.92859 4.56814 3.92859 5.35712C3.92859 6.1461 4.56818 6.78569 5.35716 6.78569C6.14614 6.78569 6.78573 6.1461 6.78573 5.35712C6.78573 4.56814 6.14614 3.92855 5.35716 3.92855Z" fill="white" />
                  </svg>
                  User Management
                </NavLink>
              </li>
              {/* <!-- Menu Item Tables --> */}

              {/* <!-- Menu Item Settings --> */}
              <li>
                <NavLink
                  to='/settings'
                  className={`group relative flex items-center gap-2.5 rounded-sm py-2 px-4 font-medium text-bodydark1 duration-300 ease-in-out hover:bg-secondary dark:hover: ${pathname.includes('settings') &&
                    'bg-secondary dark:'
                    }`}
                >
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9.00001 7.79065C11.0813 7.79065 12.7688 6.1594 12.7688 4.1344C12.7688 2.1094 11.0813 0.478149 9.00001 0.478149C6.91876 0.478149 5.23126 2.1094 5.23126 4.1344C5.23126 6.1594 6.91876 7.79065 9.00001 7.79065ZM9.00001 1.7719C10.3781 1.7719 11.5031 2.84065 11.5031 4.16252C11.5031 5.4844 10.3781 6.55315 9.00001 6.55315C7.62189 6.55315 6.49689 5.4844 6.49689 4.16252C6.49689 2.84065 7.62189 1.7719 9.00001 1.7719Z" fill="#DEE4EE" />
                    <path d="M10.8281 9.05627H7.17189C4.16251 9.05627 1.71564 11.5313 1.71564 14.5406V16.875C1.71564 17.2125 1.99689 17.5219 2.36251 17.5219C2.72814 17.5219 3.00939 17.2407 3.00939 16.875V14.5406C3.00939 12.2344 4.89376 10.3219 7.22814 10.3219H10.8563C13.1625 10.3219 15.075 12.2063 15.075 14.5406V16.875C15.075 17.2125 15.3563 17.5219 15.7219 17.5219C16.0875 17.5219 16.3688 17.2407 16.3688 16.875V14.5406C16.2844 11.5313 13.8375 9.05627 10.8281 9.05627Z" fill="#DEE4EE" />
                  </svg>
                  Profile
                </NavLink>
              </li>
              {/* <!-- Menu Item Settings --> */}


              {/* <!-- Menu Item Chart --> */}
              <li>
                <NavLink
                  to='/user-experience'
                  className={`group relative flex items-center gap-2.5 rounded-sm py-2 px-4 font-medium text-bodydark1 duration-300 ease-in-out hover:bg-secondary dark:hover: ${pathname.includes('chart') && 'bg-secondary dark:'
                    }`}
                >
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16.7069 6.18875C16.7038 6.16688 16.7 6.1475 16.695 6.12937L16.6956 6.1325C16.6762 6.04875 16.6369 5.97688 16.5819 5.91875L11.5819 0.91875C11.5244 0.864375 11.4525 0.825 11.3725 0.805625L11.3694 0.805C11.3525 0.8 11.3325 0.79625 11.3119 0.793125H11.31C11.2938 0.78875 11.2731 0.784375 11.2525 0.78125H11.25H3.75C3.49125 0.78125 3.28125 0.99125 3.28125 1.25V18.75C3.28125 19.0088 3.49125 19.2188 3.75 19.2188H16.25C16.5087 19.2188 16.7188 19.0088 16.7188 18.75V6.25C16.7156 6.22625 16.7112 6.20563 16.7062 6.18563L16.7069 6.18875ZM15.1181 5.78125H11.7188V2.38188L15.1181 5.78125ZM4.21875 18.2812V1.71875H10.7812V6.25C10.7812 6.50875 10.9913 6.71875 11.25 6.71875H15.7812V18.2812H4.21875ZM12.8969 10.6269C12.8969 10.625 12.8969 10.6225 12.8969 10.62C12.8969 9.02 11.6 7.72313 10 7.72313C8.4 7.72313 7.10312 9.02 7.10312 10.62C7.10312 11.4363 7.44063 12.1737 7.98375 12.7L7.98438 12.7006L7.03438 16.43C7.025 16.465 7.02 16.5044 7.02 16.5456C7.02 16.8044 7.23 17.0144 7.48875 17.0144C7.56063 17.0144 7.62937 16.9981 7.69 16.9688L7.68687 16.97L9.99875 15.885L12.3106 16.97C12.3688 16.9975 12.4375 17.0138 12.5094 17.0138C12.7681 17.0131 12.9775 16.8031 12.9775 16.5444C12.9775 16.5038 12.9725 16.4644 12.9625 16.4269L12.9631 16.43L12.0169 12.6962C12.5581 12.1712 12.8944 11.4375 12.895 10.625L12.8969 10.6269ZM10 8.6675C11.0825 8.6675 11.9594 9.545 11.9594 10.6269C11.9594 11.7087 11.0819 12.5863 10 12.5863C8.9175 12.5863 8.04062 11.7087 8.04062 10.6269C8.04187 9.54562 8.91813 8.66812 10 8.66687V8.6675ZM11.8125 15.7019L10.1988 14.9438C10.1406 14.9163 10.0719 14.9 10 14.9C9.92812 14.9 9.85938 14.9163 9.79813 14.945L9.80125 14.9438L8.18875 15.7006L8.81 13.2613C9.15875 13.4275 9.56812 13.5244 10 13.5244C10.4338 13.5244 10.8444 13.4269 11.2119 13.2519L11.195 13.2594L11.8125 15.7019Z" fill="white" />
                  </svg>

                  User Experience
                </NavLink>
              </li>

              {/* <!-- Menu Item Chart --> */}
            </ul>
          </div>
        </nav>
        {/* <!-- Sidebar Menu --> */}
      </div>
    </aside >
  )
}

export default Sidebar;
